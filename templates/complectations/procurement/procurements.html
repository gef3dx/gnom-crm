{% extends "base.html" %}
{% load tailwind_filters %}
{% load static %}
{% block content %}
<section class="is-hero-bar">
  <div class="flex flex-col md:flex-row items-center justify-between space-y-6 md:space-y-0">
    <h1 class="title">
      Закупки в комплектации "{{ comp_name }}"
    </h1>
    {% if procurements %}
      <span class="inline-flex items-center px-2 py-1 rounded-md font-semibold bg-black text-white text-base">
          Итого: {{ sum }} ₽
      </span>
      <span class="inline-flex items-center px-2 py-1 rounded-md font-semibold bg-black text-white text-base">
          %: {{ sum_procent }} ₽
      </span>
      <span class="inline-flex items-center px-2 py-1 rounded-md font-semibold bg-black text-white text-base">
          Итого+%: {{ sum_and_procent }} ₽
      </span>
    {% endif %}
    <a href="{% url 'procurementsaddpage' product_id=comp_id %}" class="button blue">Добавить закупку</a>
  </div>
</section>

<section class="section main-section">
<form method="post" action="">
{% csrf_token %}
  <div class="buttons nowrap mb-4">
      <a class="button small grey border-gray-300" href="{% url 'procurementslistpage' comp_slug %}">Все</a>
    {% if procurements %}
      <a class="button small grey border-gray-300" href="{% url 'procurementslistpaidpage' comp_slug %}">Оплаченные</a>
      <a class="button small grey border-gray-300" href="{% url 'procurementslistunpaidpage' comp_slug %}">Не оплаченные</a>
      <a class="button small red" href="{% url 'procurementspdfpage' comp_slug %}">PDF</a>
      <a class="button small green" href="{% url 'procurementsxlsxpage' comp_slug %}">XLSX</a>
      <button type="submit" class="button small blue">Погасить</button>
    {% endif %}
  </div>

  {% if procurements %}
      {% csrf_token %}
      <div class="card has-table">
        <div class="card-content">
          <table>
            <thead>
              <tr>
                <th>
                  <input type="checkbox" onclick="toggleSelectAll(this)" />
                </th>
                <th>№:</th>
                <th>Наименование:</th>
                <th>Чек:</th>
                <th>Смета:</th>
                <th>Описание:</th>
                <th>Пользователь:</th>
                <th>Дата:</th>
                <th>Поставщик:</th>
                <th>Статус:</th>
                <th>Процент:</th>
                <th>Сумма:</th>
                <th>Сумма%:</th>
                <th></th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for procurement in procurements %}
              <tr>
                <td data-label="Выбрать">
                  <input type="checkbox" name="procurement_ids" value="{{ procurement.id }}" />
                </td>
                <td data-label="№:">{{ forloop.counter }}</td>
                <td data-label="Наименование:">{{ procurement.name }}</td>
                <td data-label="Чек:">
                    {% if procurement.image %}
                        <a href="/media/{{ procurement.image }}">Чек</a>
                    {% else %}
                        <p>Отсутствует</p>
                    {% endif %}
                </td>
                <td data-label="Смета xlsx:">
                    {% if procurement.xlsx_file %}
                    <a class="text-green-500" href="/media/{{ procurement.xlsx_file }}">XLSX</a>
                    {% else %}
                        <p>Отсутствует</p>
                    {% endif %}
                </td>
                <td data-label="Описание:">{{ procurement.description }}</td>
                <td data-label="Пользователь:">{{ procurement.author.email }}</td>
                <td data-label="Дата:">{{ procurement.formatted_date_create }}</td>
                <td data-label="Поставщик:">{{ procurement.provider }}</td>
                <td data-label="Статус:">
                     <span class="
                     inline-flex
                     items-center
                     px-2
                     py-1
                     rounded-md
                     font-semibold
                     {% if procurement.payment_status == "Оплатил" %}
                        bg-green-500
                     {% else %}
                        bg-red-500
                     {% endif %}
                     text-white
                     text-base">
                        {{ procurement.payment_status }}
                     </span>
                </td>
                <td data-label="Процент:">{{ procurement.procent }} %</td>
                <td data-label="Сумма:">{{ procurement.price }} ₽</td>
                <td data-label="Сумма%:">{{ procurement.price_procent }} ₽</td>
                <td class="actions-cell">
                  <a href="{% url 'procurementseditpage' procurement.id %}" class="button small blue">Редактировать</a>
                </td>
                <td class="actions-cell">
                  <a href="{% url 'procurementsdeletepage' procurement.id %}" class="button small red">Удалить</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <div class="table-pagination"></div>
        </div>
      </div>
    </form>
  {% else %}
    <div class="card empty">
      <div class="card-content">
        <div>
          <span class="icon large"><i class="mdi mdi-emoticon-sad mdi-48px"></i></span>
        </div>
        <p>Здесь еще нет записей...</p>
      </div>
    </div>
  {% endif %}
</section>
<script>
  function toggleSelectAll(source) {
      checkboxes = document.querySelectorAll('input[name="procurement_ids"]');
      checkboxes.forEach(checkbox => checkbox.checked = source.checked);
  }
</script>
{% endblock %}